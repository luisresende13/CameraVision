<!DOCTYPE html>
<html>
<head>
  <title>Video Upload</title>
</head>
<body>
  <h1>Video Upload Form</h1>
  <form id="uploadForm">
    <input type="file" id="videoInput" accept="video/*">
    <button type="submit">Upload</button>
  </form>

  <div id="progressBar" style="display: none;">
    <progress id="progress" max="100" value="0"></progress>
    <span id="progressText">0%</span>
  </div>

  <div id="videoPlayer" style="display: none;">
    <h2>Uploaded Video</h2>
    <video id="uploadedVideo" controls>
      <source id="videoSource" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </div>

  <div id="downloadSection" style="display: none;">
    <h1>Baixar Video de Demonstração</h1>
    <a id="downloadButton" href="" download>Baixar</a>
  </div>

  <script>
    // Function to handle form submission
    function handleFormSubmit(event) {
      event.preventDefault();

      // Get the file input element
      const fileInput = document.getElementById('videoInput');
      const file = fileInput.files[0];

      // Create a FormData object to send the file
      const formData = new FormData();
      formData.append('video', file);

      // Display the progress bar
      const progressBar = document.getElementById('progressBar');
      progressBar.style.display = 'block';

      // Create an XMLHttpRequest object to send the form data
      const xhr = new XMLHttpRequest();

      // Set up event listeners for progress and completion
      xhr.upload.addEventListener('progress', function(event) {
        const progress = Math.round((event.loaded / event.total) * 100);
        const progressText = document.getElementById('progressText');
        progressText.textContent = progress + '%';

        const progressBar = document.getElementById('progress');
        progressBar.value = progress;
      });

      xhr.addEventListener('load', function() {
        // Hide the progress bar
        progressBar.style.display = 'none';

        if (xhr.status === 200) {
          // Upload successful
          alert('Video uploaded successfully!');

          // Display the uploaded video
          const videoPlayer = document.getElementById('videoPlayer');
          videoPlayer.style.display = 'block';

          const videoSource = document.getElementById('videoSource');
          videoSource.src = xhr.responseText;

          const uploadedVideo = document.getElementById('uploadedVideo');
          uploadedVideo.load()
          
          const downloadSection = document.getElementById('downloadSection');
          downloadSection.style.display = 'block';

          const downloadButton = document.getElementById('downloadButton')
          downloadButton.href = xhr.responseText;
            
        } else {
          // Upload failed
          alert('Error uploading video.');
        }
      });

      // Open and send the request
      xhr.open('POST', '/upload');
      xhr.send(formData);
    }

    // Add form submit event listener
    const form = document.getElementById('uploadForm');
    form.addEventListener('submit', handleFormSubmit);
  </script>
</body>
</html>
